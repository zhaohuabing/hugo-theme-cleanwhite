<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Anti-FOC (Flash of Content) Script for Dark Mode - MUST run first -->
    <script>
    (function() {
        // Determine theme BEFORE any rendering
        // Priority: 1) localStorage preference, 2) system preference
        const theme = localStorage.getItem('cleanwhite-theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const finalTheme = theme || (systemPrefersDark ? 'dark' : 'light');

        // Set theme immediately
        document.documentElement.setAttribute('data-theme', finalTheme);

        // Auto-theme (sunrise/sunset) is enabled by default
        const autoTheme = {{ if not .Site.Params.auto_theme }}false{{ else }}true{{ end }};
        if (autoTheme) {
            document.documentElement.setAttribute('data-auto-theme', 'true');
        }

        // Show content when body is available
        function showContent() {
            if (document.body) {
                document.body.classList.add('theme-loaded');
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', showContent);
        } else {
            // DOM might already be loaded, try immediately
            showContent();
        }
    })();
    </script>

    <!-- Anti-FOC (Flash of Content) Styles for Dark Mode -->
    <style>
        /* Hide body initially to prevent flash */
        body { visibility: hidden; }

        /* Critical theme colors - these apply via data-theme attribute */
        html {
            background-color: #ffffff;
            color: #404040;
        }

        /* Dark mode - applies when JS sets data-theme="dark" */
        [data-theme="dark"] {
            background-color: #040b1b !important;
            color: #c9d1d9 !important;
        }
        [data-theme="dark"] body {
            background-color: #040b1b !important;
        }

        /* Light mode - applies when JS sets data-theme="light" */
        [data-theme="light"] {
            background-color: #ffffff !important;
            color: #404040 !important;
        }
        [data-theme="light"] body {
            background-color: #ffffff !important;
        }

        /* Show body once theme is applied */
        body.theme-loaded { visibility: visible; }
    </style>

    <noscript>
        <style>
            /* Fallback for no JavaScript - default to light */
            body { visibility: visible !important; }
        </style>
    </noscript>

    <!-- start ogp -->
    <meta property="og:site_name" content="{{ .Site.Title }}">
    <meta property="og:type" content="article">

    {{ if .Params.thumbnail }}
    <meta property="og:image" content="{{ .Site.BaseURL }}{{ .Params.thumbnail }}">
    <meta property="twitter:image" content="{{ .Site.BaseURL }}{{ .Params.thumbnail }}" />
    {{ else if .Params.image}}
    <meta property="og:image" content="{{ .Site.BaseURL }}{{ .Params.image }}">
    <meta property="twitter:image" content="{{ .Site.BaseURL }}{{ .Params.image }}" />
    {{ else }}
    <meta property="og:image" content="{{ .Site.BaseURL }}/{{ .Site.Params.header_image }}">
    <meta property="twitter:image" content="{{ .Site.BaseURL }}/{{ .Site.Params.header_image }}" />
    {{ end }}

    {{ if .Params.title }}
    <meta name="title" content="{{ .Params.title }}" />
    <meta property="og:title" content="{{ .Params.title }}" />
    <meta property="twitter:title" content="{{ .Params.title }}" />
    {{ else }}
    <meta name="title" content="{{ .Site.Params.title }}" />
    <meta property="og:title" content="{{ .Site.Params.title }}" />
    <meta property="twitter:title" content="{{ .Site.Params.title }}" />
    {{ end }}

    {{ if .Params.description }}
    <meta name="description" content="{{ .Params.description }}">
    <meta property="og:description" content="{{ .Params.description }}" />
    <meta property="twitter:description" content="{{ .Params.description }}" />
    {{ else }}
    <meta name="description" content="{{ .Site.Params.description }}">
    <meta property="og:description" content="{{ .Site.Params.description }}" />
    <meta property="twitter:description" content="{{ .Site.Params.description }}" />
    {{ end }}

    <meta property="og:url" content="{{ .Permalink }}" />

    {{ if .Params.summary }}
    <meta property="twitter:card" content="{{ .Params.summary }}" />
    {{ else }}
    <meta property="twitter:card" content="summary" />
    {{ end }}
    <!-- end ogp -->

    <meta name="keyword"  content="{{ .Site.Params.keyword }}">
    <link rel="shortcut icon" href="{{ "img/favicon.ico" | relURL }}">

    <title>{{ if .Title }}{{ .Title }} | {{ .Site.Params.SEOTitle }}{{ else }}{{ .Site.Params.SEOTitle }}{{ end }}</title>

    <link rel="canonical" href="{{ .RelPermalink }}">

    {{ if .Site.Params.disqus_proxy }}
    <link rel="stylesheet" href="{{ "css/iDisqus.min.css" | relURL }}"/>
    {{ end }}

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="{{ "css/bootstrap.min.css" | relURL }}">

    <!-- Clean White theme CSS -->
    <link rel="stylesheet" href="{{ "css/hugo-theme-cleanwhite.css" | relURL }}">

    <!-- Theme Variables CSS -->
    <link rel="stylesheet" href="{{ "css/theme-variables.css" | relURL }}">

    <!-- zangshang CSS -->
    <link rel="stylesheet" href="{{ "css/zanshang.min.css" | relURL }}">

    <!-- Custom Fonts -->
    <link rel="stylesheet" href="{{ "css/font-awesome.all.min.css" | relURL }}">

    <!-- KaTeX CSS  -->
    {{ $noop := .WordCount }}
    {{ if .Page.Store.Get "hasMath" -}}
        {{ partial "math/katex-css.html" . -}}
        {{ partial "math/katex-fonts.html" . -}}
    {{ end -}}

    <!--  Custom CSS  -->
    {{ range .Site.Params.custom_css -}}
    <link rel="stylesheet" href="{{ . | absURL }}">
    {{- end }}

    <!-- jQuery -->
    <script src="{{ "js/jquery.min.js" | relURL }}"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="{{ "js/bootstrap.min.js" | relURL }}"></script>

    <!-- Hux Theme JavaScript -->
    <script src="{{ "js/hux-blog.min.js" | relURL }}"></script>

    <!-- lazy load image JavaScript -->
    <script src="{{ "js/lazysizes.min.js" | relURL }}"></script>

    <!-- Custom JS -->
    {{ range .Site.Params.custom_js }}
    <script src="{{ . | absURL }}"></script>
    {{ end }}

</head>

{{ if .Site.Config.Services.GoogleAnalytics.ID }}
{{ template "_internal/google_analytics.html" . }}
{{ end }}
